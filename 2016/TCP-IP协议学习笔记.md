# TCP-IP协议学习笔记

## 层次结构

通常被分为四层，其实总共有七层。只是有些厂商去掉了或者融合了一些层次结构。所以，正常情况下可分为一下四层：

- 链路层，包括操作系统的设备驱动程序和计算机中的网卡。物理与物理电缆之间的传输细节。wifi进行上网时，是如何传输的。其实也是物理电缆。通过无线技术传输到相对应的无线发出设备。然后再由路由器传输到相对应的节点。
- 传输层，为两台计算机上的程序提供端到端的通信。包括两个不同的协议TCP(transport control protrol)和UDP(user data protrol)。
- 网络层，也可称作互联网层，这一层非常必要。是处理分组的数据包在网络中的活动。网路层协议包括，IP(网际协议)，ICMP(网络控制报文协议)。IGMP(网络组管理协议)。
- 应用层，处理特定的应用程序细节。

传输层的必要性:

在TCP/IP协议族中，网络层IP提供的是一种不可靠的服务。也就是说，它只是尽可能快地把分组从源结点送到目的结点，但是并不提供任何可靠性保证。而另一方面，TCP在不可靠的IP层上提供了一个可靠的运输层。为了提供这种可靠的服务，TCP采用了超时重传、发送和接收端到端的确认分组等机制。由此可见，运输层和网络层分别负责不同的功能。

从上面看出，不管是TCP还是UDP，其实都是通过ip进行数据包传输的。所以，ip协议才是重点。下来记录下ip协议的重点。

## IP协议

IP地址分为5类。如下

| 类别   | 标识位   | 网络号  | 主机号  |
| ---- | ----- | ---- | ---- |
| A    | 0     | 7位   | 24位  |
| B    | 10    | 14位  | 16位  |
| C    | 110   | 21位  | 8位   |
| D    | 1110  | 28位  | 多插组号 |
| E    | 11110 | 27位  | 留待备用 |

分辨ip地址类型是通过第一个十进制整数来判断:

| 类型   | 范围                        |
| ---- | ------------------------- |
| A    | 0.0.0.0-127.255.255.255   |
| B    | 128.0.0.0-191.255.255.255 |
| C    | 192.0.0.0-223.255.255.255 |
| D    | 224.0.0.0-239.255.255.255 |
| E    | 240.0.0.0-247.255.255.255 |

IP地址由互联网信息中心分配网络号，由管理员分配主机号所得。

UDP数据与TCP数据基本一致。唯一的不同是UDP传给IP的信息单元称作UDP数据报（UDP datagram），而且UDP的首部长为8字节。

回想1.3节中的图1-4，由于TCP、UDP、ICMP和IGMP都要向IP传送数据，因此IP必须在生成的IP首部中加入某种标识，以表明数据属于哪一层。为此，IP在首部中存入一个长度为8bit的数值，称作协议域。1表示为ICMP协议，2表示为IGMP协议，6表示为TCP协议，17表示为UDP协议。

类似地，许多应用程序都可以使用TCP或UDP来传送数据。运输层协议在生成报文首部时要存入一个应用程序的标识符。TCP和UDP都用一个16bit的端口号来表示不同的应用程序。TCP和UDP把源端口号和目的端口号分别存入报文首部中。

网络接口分别要发送和接收IP、ARP和RARP数据，因此也必须在以太网的帧首部中加入某种形式的标识，以指明生成数据的网络层协议。为此，以太网的帧首部也有一个16 bit的帧类型域。

特性：*不可靠，无连接。*

